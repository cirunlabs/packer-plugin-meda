version: 2

project_name: packer-plugin-meda

env:
  - CGO_ENABLED=0

before:
  hooks:
    - go test ./...
    - go mod tidy
    - make plugin-check

builds:
  - id: linux-amd64
    binary: packer-plugin-meda_v{{.Version}}_x5.0_linux_amd64
    goos:
      - linux
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s -w -X main.Version={{.Version}} -X main.VersionPrerelease=
    mod_timestamp: '{{ .CommitTimestamp }}'

  - id: linux-arm64
    binary: packer-plugin-meda_v{{.Version}}_x5.0_linux_arm64
    goos:
      - linux
    goarch:
      - arm64
    flags:
      - -trimpath
    ldflags:
      - -s -w -X main.Version={{.Version}} -X main.VersionPrerelease=
    mod_timestamp: '{{ .CommitTimestamp }}'

archives:
  - id: linux-amd64
    ids:
      - linux-amd64
    name_template: "packer-plugin-meda_v{{ .Version }}_x5.0_linux_amd64"
    formats: [zip]
    files:
      - LICENSE*
      - README*

  - id: linux-arm64
    ids:
      - linux-arm64
    name_template: "packer-plugin-meda_v{{ .Version }}_x5.0_linux_arm64"
    formats: [zip]
    files:
      - LICENSE*
      - README*

checksum:
  name_template: "{{ .ProjectName }}_{{ .Version }}_SHA256SUMS"
  algorithm: sha256

changelog:
  disable: true

release:
  draft: false
  prerelease: auto
  name_template: "v{{ .Version }}"
  header: |
    ## Packer Plugin for Meda v{{ .Version }}

    This release contains binaries for the Packer plugin for Meda.

    ### Installation

    ```bash
    # Install using packer init (recommended)
    packer init github.com/cirunlabs/meda

    # Or download manually
    curl -LO https://github.com/cirunlabs/packer-plugin-meda/releases/download/v{{ .Version }}/packer-plugin-meda_v{{ .Version }}_x5.0_linux_amd64.zip
    unzip packer-plugin-meda_v{{ .Version }}_x5.0_linux_amd64.zip
    packer plugins install --path packer-plugin-meda_v{{ .Version }}_x5.0_linux_amd64 github.com/cirunlabs/meda
    ```

    ### Usage

    See the [documentation](https://github.com/cirunlabs/packer-plugin-meda/blob/main/README.md) for usage examples.
  footer: |
    **Full Changelog**: https://github.com/cirunlabs/packer-plugin-meda/compare/{{ .PreviousTag }}...v{{ .Tag }}
  extra_files:
    - glob: ./docs/**/DOCS.md

snapshot: {}